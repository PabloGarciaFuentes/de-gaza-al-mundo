---
import TransparenciaImg_6 from "../assets/images/transparency/transparencia_6.jpg";
import TransparenciaImg_7 from "../assets/images/transparency/transparencia_7.jpg";
import TransparenciaImg_8 from "../assets/images/transparency/transparencia_8.jpg";
import TransparenciaImg_9 from "../assets/images/transparency/transparencia_9.jpg";
import TransparenciaImg_10 from "../assets/images/transparency/transparencia_10.jpg";
import TransparenciaImg_11 from "../assets/images/transparency/transparencia_11.jpg";
import TransparenciaImg_12 from "../assets/images/transparency/transparencia_12.jpg";
import TransparenciaImg_13 from "../assets/images/transparency/transparencia_13.jpg";
import TransparenciaImg_14 from "../assets/images/transparency/transparencia_14.jpg";
import TransparenciaImg_15 from "../assets/images/transparency/transparencia_15.jpg";
import TransparenciaImg_16 from "../assets/images/transparency/transparencia_16.jpg";
import TransparenciaImg_17 from "../assets/images/transparency/transparencia_17.jpg";
import TransparenciaImg_18 from "../assets/images/transparency/transparencia_18.jpg";
import TransparenciaImg_19 from "../assets/images/transparency/transparencia_19.jpg";
import TransparenciaImg_20 from "../assets/images/transparency/transparencia_20.jpg";
import TransparenciaImg_21 from "../assets/images/transparency/transparencia_21.jpg";
import TransparenciaImg_22 from "../assets/images/transparency/transparencia_22.jpg";
import TransparenciaImg_23 from "../assets/images/transparency/transparencia_23.jpg";
import TransparenciaImg_24 from "../assets/images/transparency/transparencia_24.jpg";
import TransparenciaImg_25 from "../assets/images/transparency/transparencia_25.jpg";
import TransparenciaImg_26 from "../assets/images/transparency/transparencia_26.jpg";
import TransparenciaImg_27 from "../assets/images/transparency/transparencia_27.jpg";
import TransparenciaImg_28 from "../assets/images/transparency/transparencia_28.jpg";
import TransparenciaImg_29 from "../assets/images/transparency/transparencia_29.jpg";
import TransparenciaImg_30 from "../assets/images/transparency/transparencia_30.jpg";
import TransparenciaImg_31 from "../assets/images/transparency/transparencia_31.jpg";
import TransparenciaImg_32 from "../assets/images/transparency/transparencia_32.jpg";
import TransparenciaImg_33 from "../assets/images/transparency/transparencia_33.jpg";
import TransparenciaImg_34 from "../assets/images/transparency/transparencia_34.jpg";
import TransparenciaImg_35 from "../assets/images/transparency/transparencia_35.jpg";
import TransparenciaImg_36 from "../assets/images/transparency/transparencia_36.jpg";

const defaultData = {
  header: {
    badge: "Transparencia",
    title: "Nuestra labor, contada con imágenes",
    description: "Cada gesto solidario nos une y construye esperanza. Detrás de cada aporte hay personas que se ayudan entre sí y comunidades que vuelven a sentirse acompañadas. Compartimos imágenes reales de nuestras acciones para que puedas ver cómo, juntos, transformamos la solidaridad en apoyo concreto y en un futuro más digno para quienes más lo necesitan.",
    linkText: "Ver galería completa",
    linkIcon: "arrow_forward",
    url: "#",
  },
  gallery: [
    {
      image: TransparenciaImg_6.src,
      alt: "TransparenciaImg_6",
      caption: ""
    },
    {
      image: TransparenciaImg_7.src,
      alt: "TransparenciaImg_7",
      caption: ""
    },
    {
      image: TransparenciaImg_8.src,
      alt: "TransparenciaImg_8",
      caption: ""
    },
    {
      image: TransparenciaImg_9.src,
      alt: "TransparenciaImg_9",
      caption: ""
    },
    {
      image: TransparenciaImg_10.src,
      alt: "TransparenciaImg_10",
      caption: ""
    },
    {
      image: TransparenciaImg_11.src,
      alt: "TransparenciaImg_11",
      caption: ""
    },
    {
      image: TransparenciaImg_12.src,
      alt: "TransparenciaImg_12",
      caption: ""
    },
    {
      image: TransparenciaImg_13.src,
      alt: "TransparenciaImg_13",
      caption: ""
    },
    {
      image: TransparenciaImg_14.src,
      alt: "TransparenciaImg_14",
      caption: ""
    },
    {
      image: TransparenciaImg_15.src,
      alt: "TransparenciaImg_15",
      caption: ""
    },
    {
      image: TransparenciaImg_16.src,
      alt: "TransparenciaImg_16",
      caption: ""
    },
    {
      image: TransparenciaImg_17.src,
      alt: "TransparenciaImg_17",
      caption: ""
    },
    {
      image: TransparenciaImg_18.src,
      alt: "TransparenciaImg_18",
      caption: ""
    },
    {
      image: TransparenciaImg_19.src,
      alt: "TransparenciaImg_19",
      caption: ""
    },
    {
      image: TransparenciaImg_20.src,
      alt: "TransparenciaImg_20",
      caption: ""
    },
    {
      image: TransparenciaImg_21.src,
      alt: "TransparenciaImg_21",
      caption: ""
    },
    {
      image: TransparenciaImg_22.src,
      alt: "TransparenciaImg_22",
      caption: ""
    },
    {
      image: TransparenciaImg_23.src,
      alt: "TransparenciaImg_23",
      caption: ""
    },
    {
      image: TransparenciaImg_24.src,
      alt: "TransparenciaImg_24",
      caption: ""
    },
    {
      image: TransparenciaImg_25.src,
      alt: "TransparenciaImg_25",
      caption: ""
    },
    {
      image: TransparenciaImg_26.src,
      alt: "TransparenciaImg_26",
      caption: ""
    },
    {
      image: TransparenciaImg_27.src,
      alt: "TransparenciaImg_27",
      caption: ""
    },
    {
      image: TransparenciaImg_28.src,
      alt: "TransparenciaImg_28",
      caption: ""
    },
    {
      image: TransparenciaImg_29.src,
      alt: "TransparenciaImg_29",
      caption: ""
    },
    {
      image: TransparenciaImg_30.src,
      alt: "TransparenciaImg_30",
      caption: ""
    },
    {
      image: TransparenciaImg_31.src,
      alt: "TransparenciaImg_31",
      caption: ""
    },
    {
      image: TransparenciaImg_32.src,
      alt: "TransparenciaImg_32",
      caption: ""
    },
    {
      image: TransparenciaImg_33.src,
      alt: "TransparenciaImg_33",
      caption: ""
    },
    {
      image: TransparenciaImg_34.src,
      alt: "TransparenciaImg_34",
      caption: ""
    },
    {
      image: TransparenciaImg_35.src,
      alt: "TransparenciaImg_35",
      caption: ""
    },
    {
      image: TransparenciaImg_36.src,
      alt: "TransparenciaImg_36",
      caption: ""
    }
  ]
};

const { data = defaultData } = Astro.props;
---

<!-- SectionHeader + ImageGrid -->
<section id="transparency-section" class="py-16 md:py-24 bg-white scroll-mt-20">
  <div class="w-full max-w-7xl mx-auto px-4 sm:px-10">
    <div
      class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12"
    >
      <div class="max-w-2xl">
        <span
          class="text-[#236E1E] font-bold tracking-wider text-sm uppercase mb-2 flex items-center gap-2"
        >
          {data.header.badge}
        </span>
        <h2
          class="text-[#171212] text-3xl md:text-4xl font-bold leading-tight tracking-tight"
        >
          {data.header.title}
        </h2>
        <p class="text-[#6b6b6b] mt-4 text-lg">
          {data.header.description}
        </p>
      </div>
      <button
        id="show-all-btn"
        class="hidden md:flex items-center gap-2 text-[#931a24] font-bold hover:text-red-800 transition-colors hover:cursor-pointer"
      >
        <span id="show-all-text">{data.header.linkText}</span>
        <span class="material-symbols-outlined" id="show-all-icon">{data.header.linkIcon}</span>
      </button>
    </div>
    
    <!-- Mobile Grid (visible only on mobile) -->
    <div class="md:hidden">
      <div id="initial-images-mobile" class="grid grid-cols-2 gap-4">
        {data.gallery.slice(0, 4).map((item: { alt: string; image: any; caption: unknown; }, index: number) => (
          <div class="group relative overflow-hidden rounded-xl aspect-square shadow-sm cursor-pointer" data-modal-trigger data-image-index={index}>
            <img
              id={`mobile-initial-img-${index}`}
              src={item.image}
              alt={item.alt}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              loading="lazy"
              width="300"
              height="300"
            />
            <div
              class="absolute inset-0 bg-linear-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4"
            >
              <p class="text-white font-medium">{item.caption}</p>
            </div>
          </div>
        ))}
      </div>
      
      <!-- All Images Mobile Grid (initially hidden, replaces initial grid when expanded) -->
      <div id="all-images-mobile" class="grid grid-cols-2 gap-4" style="display: none;">
        {data.gallery.map((item: { alt: string; image: any; caption: unknown; }, index: number) => (
          <div class="group relative overflow-hidden rounded-xl aspect-square shadow-sm opacity-0 transition-opacity duration-300 ease-in-out all-image cursor-pointer" data-modal-trigger data-image-index={index}>
            <img
              id={`mobile-all-img-${index}`}
              src={item.image}
              alt={item.alt}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              loading="lazy"
              width="300"
              height="300"
            />
            <div
              class="absolute inset-0 bg-linear-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4"
            >
              <p class="text-white font-medium">{item.caption}</p>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Desktop Grid (hidden on mobile) -->
    <div class="hidden md:grid grid-cols-2 lg:grid-cols-4 gap-6">
      {data.gallery.slice(0, 4).map((item: { alt: string; image: any; caption: unknown; }, index: number) => (
        <div
          class="group relative overflow-hidden rounded-xl aspect-square shadow-sm hover:cursor-pointer" data-modal-trigger data-image-index={index}
        >
          <img
            id={`desktop-initial-img-${index}`}
            src={item.image}
            alt={item.alt}
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            loading="lazy"
            width="300"
            height="300"
          />
          <div
            class="absolute inset-0 bg-linear-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4"
          >
            <p class="text-white font-medium">{item.caption}</p>
          </div>
        </div>
      ))}
    </div>
    
    <!-- Additional Images (initially hidden) -->
    <div id="additional-images-desktop" class="hidden md:grid grid-cols-2 lg:grid-cols-4 gap-6 mt-6" style="display: none;">
      {data.gallery.slice(4).map((item: { alt: string; image: any; caption: unknown; }, index: number) => (
        <div
          class="group relative overflow-hidden rounded-xl aspect-square shadow-sm opacity-0 transition-opacity duration-300 ease-in-out additional-image hover:cursor-pointer" data-modal-trigger data-image-index={index + 4}
        >
          <img
            id={`desktop-additional-img-${index + 4}`}
            src={item.image}
            alt={item.alt}
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            loading="lazy"
            width="300"
            height="300"
          />
          <div
            class="absolute inset-0 bg-linear-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4"
          >
            <p class="text-white font-medium">{item.caption}</p>
          </div>
        </div>
      ))}
    </div>
    <div class="mt-8 text-center md:hidden">
      <button
        id="show-all-btn-mobile"
        class="inline-flex items-center gap-2 text-[#931a24] font-bold transition-colors"
      >
        <span id="show-all-text-mobile">{data.header.linkText}</span>
        <span class="material-symbols-outlined" id="show-all-icon-mobile">{data.header.linkIcon}</span>
      </button>
    </div>
  </div>
</section>

<!-- Modal para galería de imágenes -->
<div id="image-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-9999 opacity-0 pointer-events-none transition-opacity duration-300 ease-out">
  <div class="absolute inset-0 flex items-center justify-center p-4">
    <!-- Botón cerrar -->
    <button 
      id="close-modal" 
      class="absolute top-4 right-4 z-10 w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center transition-colors duration-200 backdrop-blur-sm"
      aria-label="Cerrar modal"
    >
      <span class="material-symbols-outlined text-white text-xl">close</span>
    </button>
    
    <!-- Navegación anterior -->
    <button 
      id="prev-image" 
      class="absolute left-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center transition-colors duration-200 backdrop-blur-sm"
      aria-label="Imagen anterior"
    >
      <span class="material-symbols-outlined text-white text-2xl">chevron_left</span>
    </button>
    
    <!-- Navegación siguiente -->
    <button 
      id="next-image" 
      class="absolute right-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center transition-colors duration-200 backdrop-blur-sm"
      aria-label="Imagen siguiente"
    >
      <span class="material-symbols-outlined text-white text-2xl">chevron_right</span>
    </button>
    
    <!-- Contenedor de imagen -->
    <div class="relative max-w-5xl max-h-full w-full h-full flex items-center justify-center">
      <img 
        id="modal-image" 
        class="max-w-full max-h-full w-auto h-auto object-contain rounded-lg shadow-2xl" 
        alt="" 
      />
      
      <!-- Indicador de posición -->
      <div class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/60 backdrop-blur-sm px-3 py-1 rounded-full">
        <span id="image-counter" class="text-white text-sm font-medium"></span>
      </div>
    </div>
  </div>
</div>

<style>
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
</style>

<script define:vars={{ galleryData: data.gallery }}>
  // Pass gallery data to window object for client-side access
  window.transparencyGalleryData = galleryData;
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    let showingAll = false;
    let currentImageIndex = 0;
    let galleryImages: string | any[] = [];
    
    // Initialize gallery images array
    const galleryData = (window as any).transparencyGalleryData || [];
    
    // Check if we're on mobile or desktop
    function isMobile() {
      return window.innerWidth < 768; // md breakpoint
    }
    
    // Gallery toggle functionality
    function toggleGallery() {
      const additionalDesktop = document.getElementById('additional-images-desktop');
      const initialMobile = document.getElementById('initial-images-mobile');
      const allMobile = document.getElementById('all-images-mobile');
      const showAllBtn = document.getElementById('show-all-btn');
      const showAllBtnMobile = document.getElementById('show-all-btn-mobile');
      const showAllText = document.getElementById('show-all-text');
      const showAllTextMobile = document.getElementById('show-all-text-mobile');
      const showAllIcon = document.getElementById('show-all-icon');
      const showAllIconMobile = document.getElementById('show-all-icon-mobile');
      
      if (!showingAll) {
        // Show all images
        if (!isMobile() && additionalDesktop) {
          // Desktop behavior
          additionalDesktop.style.display = 'grid';
          setTimeout(() => {
            const additionalImages = additionalDesktop.querySelectorAll('.additional-image');
            additionalImages.forEach((img, index) => {
              setTimeout(() => {
                (img as HTMLElement).style.opacity = '1';
              }, index * 100);
            });
          }, 50);
        }
        
        if (isMobile() && initialMobile && allMobile) {
          // Mobile behavior: hide initial grid and show all images grid
          initialMobile.style.display = 'none';
          allMobile.style.display = 'grid';
          setTimeout(() => {
            const allImages = allMobile.querySelectorAll('.all-image');
            allImages.forEach((img, index) => {
              setTimeout(() => {
                (img as HTMLElement).style.opacity = '1';
              }, index * 100);
            });
          }, 50);
        }
        
        // Update button text
        if (showAllText) showAllText.textContent = 'Ocultar imágenes';
        if (showAllTextMobile) showAllTextMobile.textContent = 'Ocultar imágenes';
        if (showAllIcon) showAllIcon.textContent = 'arrow_upward';
        if (showAllIconMobile) showAllIconMobile.textContent = 'arrow_upward';
        
        showingAll = true;
      } else {
        // Hide additional images
        if (!isMobile()) {
          // Desktop behavior
          const additionalImages = document.querySelectorAll('.additional-image');
          additionalImages.forEach((img, index) => {
            setTimeout(() => {
              (img as HTMLElement).style.opacity = '0';
            }, index * 20);
          });
          
          setTimeout(() => {
            if (additionalDesktop) {
              additionalDesktop.style.display = 'none';
            }
          }, additionalImages.length * 20 + 100);
        }
        
        if (isMobile()) {
          // Mobile behavior: fade out all images
          const allImages = document.querySelectorAll('.all-image');
          allImages.forEach((img, index) => {
            setTimeout(() => {
              (img as HTMLElement).style.opacity = '0';
            }, index * 20);
          });
          
          setTimeout(() => {
            if (initialMobile && allMobile) {
              allMobile.style.display = 'none';
              initialMobile.style.display = 'grid';
            }
            // Scroll to transparency section after hiding gallery
            const transparencySection = document.getElementById('transparency-section');
            if (transparencySection) {
              transparencySection.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
              });
            }
          }, allImages.length * 20 + 100);
        }
        
        // Update button text
        if (showAllText) showAllText.textContent = 'Ver galería completa';
        if (showAllTextMobile) showAllTextMobile.textContent = 'Ver galería completa';
        if (showAllIcon) showAllIcon.textContent = 'arrow_forward';
        if (showAllIconMobile) showAllIconMobile.textContent = 'arrow_forward';
        
        showingAll = false;
      }
    }
    
    // Add event listeners to buttons
    const showAllBtn = document.getElementById('show-all-btn');
    const showAllBtnMobile = document.getElementById('show-all-btn-mobile');
    
    if (showAllBtn) {
      showAllBtn.addEventListener('click', toggleGallery);
    }
    if (showAllBtnMobile) {
      showAllBtnMobile.addEventListener('click', toggleGallery);
    }
    
    // Modal functionality
    const modal = document.getElementById('image-modal');
    const modalImage = document.getElementById('modal-image');
    const imageCounter = document.getElementById('image-counter');
    const closeBtn = document.getElementById('close-modal');
    const prevBtn = document.getElementById('prev-image');
    const nextBtn = document.getElementById('next-image');
    
    // Get all gallery images from window object
    galleryImages = (window as any).transparencyGalleryData || [];
    
    function openModal(imageIndex: number) {
      if (!modal) return;
      currentImageIndex = imageIndex;
      updateModalImage();
      modal.classList.remove('opacity-0', 'pointer-events-none');
      modal.classList.add('opacity-100');
      document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
      if (!modal) return;
      modal.classList.add('opacity-0', 'pointer-events-none');
      modal.classList.remove('opacity-100');
      document.body.style.overflow = '';
    }
    
    function updateModalImage() {
      if (!modalImage || !imageCounter) return;
      if (galleryImages[currentImageIndex]) {
        const imageData = galleryImages[currentImageIndex];
        (modalImage as HTMLImageElement).src = imageData.image;
        (modalImage as HTMLImageElement).alt = imageData.alt;
        imageCounter.textContent = `${currentImageIndex + 1} / ${galleryImages.length}`;
      }
    }
    
    function nextImage() {
      currentImageIndex = (currentImageIndex + 1) % galleryImages.length;
      updateModalImage();
    }
    
    function prevImage() {
      currentImageIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
      updateModalImage();
    }
    
    // Event listeners para triggers del modal
    document.addEventListener('click', function(e) {
      if (!e.target) return;
      const trigger = (e.target as Element).closest('[data-modal-trigger]');
      if (trigger) {
        const imageIndex = parseInt(trigger.getAttribute('data-image-index') || '0');
        openModal(imageIndex);
      }
    });
    
    // Event listeners para controles del modal
    if (closeBtn) closeBtn.addEventListener('click', closeModal);
    if (prevBtn) prevBtn.addEventListener('click', prevImage);
    if (nextBtn) nextBtn.addEventListener('click', nextImage);
    
    // Cerrar modal con tecla ESC
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && modal && !modal.classList.contains('pointer-events-none')) {
        closeModal();
      }
      if (e.key === 'ArrowLeft' && modal && !modal.classList.contains('pointer-events-none')) {
        prevImage();
      }
      if (e.key === 'ArrowRight' && modal && !modal.classList.contains('pointer-events-none')) {
        nextImage();
      }
    });
    
    // Cerrar modal al hacer click en el fondo
    if (modal) {
      modal.addEventListener('click', function(e) {
        // Verificar si el click fue fuera de la imagen y los botones de control
        const modalImage = document.getElementById('modal-image');
        const isClickOnImage = modalImage && modalImage.contains(e.target as Node);
        const isClickOnButton = (e.target as Element).closest('button');
        
        if (!isClickOnImage && !isClickOnButton) {
          closeModal();
        }
      });
    }
  });
</script>
