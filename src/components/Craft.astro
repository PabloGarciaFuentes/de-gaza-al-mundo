---
import CamisetaImg from '../assets/images/craft/camiseta_2.png';
import LlaverosImg from '../assets/images/craft/llaveros_1.jpg';
import BaberosImg from '../assets/images/craft/baberos_1.jpg';
import LibrosImg from '../assets/images/craft/libro_1.png';

const defaultData = {
  header: {
    badge: "Artesanía Solidaria",
    title: "Apoya con el Corazón,<br />Lleva Palestina Contigo",
    description: "Nuestros voluntarios y familias elaboran con dedicación hermosas piezas artesanales. Cada pulsera, llavero y camiseta que adquieres es un donativo directo que se transforma en ayuda humanitaria."
  },
  features: [
    {
      icon: "palette",
      iconBg: "bg-black/5",
      iconColor: "text-black",
      title: "Diseños Auténticos",
      description: "Inspirados en la cultura y los colores de nuestra tierra: rojo, negro, blanco y verde."
    },
    {
      icon: "favorite",
      iconBg: "bg-[#236E1E]/10",
      iconColor: "text-[#236E1E]", 
      title: "Impacto Real",
      description: "El 100% de los beneficios se destina a la compra de alimentos y medicinas."
    }
  ],
  products: [
    {
      image: BaberosImg.src,
      alt: "Babero con diseño palestino",
      category: "Baberos",
      categoryColor: "bg-[#931a24]",
      aspectRatio: "aspect-3/4"
    },
    {
      image: CamisetaImg.src,
      alt: "White t-shirt with Palestinian embroidery design",
      category: "Camisetas",
      categoryColor: "bg-[#236E1E]",
      aspectRatio: "aspect-square"
    },
    {
      image: LlaverosImg.src,
      alt: "Llaveros con diseño palestino",
      category: "Llaveros",
      categoryColor: "bg-black",
      aspectRatio: "aspect-square"
    },
    {
      image: LibrosImg.src,
      alt: "Libro con temática palestina",
      category: "Libros",
      categoryColor: "bg-white",
      categoryTextColor: "text-black",
      aspectRatio: "aspect-3/4"
    }
  ],
  cta: {
    icon: "shopping_bag",
    label: "Ver Catálogo",
    url: "https://www.canva.com/design/DAG5dynujUo/01FSx7j2KWv66Oc9XuNWnw/view?utlId=h6587fed21c"
  }
};

const { data = defaultData } = Astro.props;
---

<!-- CraftSection -->
<section
  id="craft-section" class="relative bg-[#f8f6f6] py-16 md:py-24 border-t border-[#e5e7eb] scroll-mt-10"
>
  <div class="w-full max-w-7xl mx-auto px-4 sm:px-10">
    <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-16">
      <div class="lg:w-1/2 order-2 lg:order-1">
        <span
          class="text-[#931a24] font-bold tracking-wider text-sm uppercase mb-2 flex items-center gap-2"
        >
          <span class="w-2 h-2 rounded-full bg-[#931a24]"></span>
          {data.header.badge}
        </span>
        <h2
          class="text-[#171212] text-3xl md:text-4xl font-black leading-tight mb-6"
          set:html={data.header.title}
        >
        </h2>
        <p class="text-[#6b6b6b] text-lg leading-relaxed mb-8">
          {data.header.description}
        </p>
        <div class="space-y-6">
          {data.features.map((feature: { iconBg: any; iconColor: any; icon: unknown; title: unknown; description: unknown; }) => (
            <div class="flex gap-4 items-start">
              <div
                class={`w-12 h-12 rounded-full ${feature.iconBg} flex items-center justify-center ${feature.iconColor} shrink-0`}
              >
                <span class="material-symbols-outlined text-2xl" style="font-variation-settings: 'FILL' 1;">{feature.icon}</span>
              </div>
              <div>
                <h3 class="text-lg font-bold text-[#171212] mb-1">
                  {feature.title}
                </h3>
                <p class="text-[#6b6b6b]">
                  {feature.description}
                </p>
              </div>
            </div>
          ))}
        </div>
        <!-- Mobile Slider (visible only on mobile) -->
        <div class="mt-8 lg:hidden overflow-hidden">
          <div id="craft-slider" class="flex gap-4 overflow-x-auto scroll-smooth scrollbar-hide snap-x snap-mandatory">
            {data.products.map((product: { image: string | null | undefined; alt: string | null | undefined; categoryColor: any; categoryTextColor: any; category: unknown; }) => (
              <div class="flex-none w-[calc(50%-8px)] snap-start">
                <div class="relative rounded-xl overflow-hidden shadow-lg aspect-3/4 group border-4 border-white">
                  <img
                    src={product.image}
                    alt={product.alt}
                    class="w-full h-full object-cover"
                  />
                  <div class="absolute bottom-4 left-4">
                    <span class={`inline-block px-3 py-1 ${product.categoryColor} ${product.categoryTextColor || 'text-white'} font-bold rounded-lg shadow-md text-xs`}>
                      {product.category}
                    </span>
                  </div>
                </div>
              </div>
            ))}
          </div>
          <!-- Arrow Navigation -->
          <div class="flex justify-center items-center gap-8 mt-4">
            <button 
              id="craft-prev-arrow" 
              class="flex items-center justify-center w-10 h-10 rounded-full bg-white border-2 border-[#931a24] text-[#931a24] hover:bg-[#931a24] hover:text-white transition-all duration-200 shadow-md opacity-30 cursor-not-allowed"
              aria-label="Ver productos anteriores"
            >
              <span class="material-symbols-outlined">chevron_left</span>
            </button>
            <span class="text-sm text-[#6b6b6b] font-medium">
              <span id="craft-current-slide">1</span> / 2
            </span>
            <button 
              id="craft-next-arrow" 
              class="flex items-center justify-center w-10 h-10 rounded-full bg-white border-2 border-[#931a24] text-[#931a24] hover:bg-[#931a24] hover:text-white transition-all duration-200 shadow-md"
              aria-label="Ver más productos"
            >
              <span class="material-symbols-outlined">chevron_right</span>
            </button>
          </div>
        </div>
        <div class="mt-10 flex gap-4 justify-center lg:justify-start">
          <a
            href={data.cta.url}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center gap-2 rounded-lg h-12 px-6 bg-black text-white hover:bg-gray-800 transition-colors font-bold shadow-lg cursor-pointer"
          >
            <span class="material-symbols-outlined">{data.cta.icon}</span>
            {data.cta.label}
          </a>
        </div>
      </div>
      <!-- Desktop Grid (hidden on mobile) -->
      <div class="lg:w-1/2 order-1 lg:order-2 hidden lg:block">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="space-y-4 lg:translate-y-8">
            <div
              class="relative rounded-xl overflow-hidden shadow-lg aspect-3/4 group border-4 border-white min-h-62.5"
            >
              <img
                src={data.products[0].image}
                alt={data.products[0].alt}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                loading="lazy"
                width="300"
                height="400"
              />
              <div class="absolute bottom-4 left-4">
                <span
                  class={`inline-block px-4 py-2 ${data.products[0].categoryColor} text-white font-bold rounded-lg shadow-md text-sm`}
                >
                  {data.products[0].category}
                </span>
              </div>
            </div>
            <div
              class="relative rounded-xl overflow-hidden shadow-lg aspect-square group border-4 border-white min-h-50"
            >
              <img
                src={data.products[1].image}
                alt={data.products[1].alt}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                loading="lazy"
                width="300"
                height="300"
              />
              <div class="absolute bottom-4 left-4">
                <span
                  class={`inline-block px-4 py-2 ${data.products[1].categoryColor} text-white font-bold rounded-lg shadow-md text-sm`}
                >
                  {data.products[1].category}
                </span>
              </div>
            </div>
          </div>
          <div class="space-y-4">
            <div
              class="relative rounded-xl overflow-hidden shadow-lg aspect-square group border-4 border-white min-h-50"
            >
              <img
                src={data.products[2].image}
                alt={data.products[2].alt}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
              />
              <div class="absolute bottom-4 left-4">
                <span
                  class={`inline-block px-4 py-2 ${data.products[2].categoryColor} text-white font-bold rounded-lg shadow-md text-sm`}
                >
                  {data.products[2].category}
                </span>
              </div>
            </div>
            <div
              class="relative rounded-xl overflow-hidden shadow-lg aspect-3/4 group border-4 border-white min-h-62.5"
            >
              <img
                src={data.products[3].image}
                alt={data.products[3].alt}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
              />
              <div class="absolute bottom-4 left-4">
                <span
                  class={`inline-block px-4 py-2 ${data.products[3].categoryColor} ${data.products[3].categoryTextColor || 'text-white'} font-bold rounded-lg shadow-md text-sm`}
                >
                  {data.products[3].category}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Craft Slider functionality
    const craftSlider = document.getElementById('craft-slider');
    const craftPrevArrow = document.getElementById('craft-prev-arrow');
    const craftNextArrow = document.getElementById('craft-next-arrow');
    const craftCurrentSlide = document.getElementById('craft-current-slide');
    
    if (craftSlider && craftPrevArrow && craftNextArrow) {
      let currentSlide = 0;
      const totalSlides = 2; // 4 products, 2 per view = 2 slides
      
      function updateArrows() {
        // Update prev arrow
        if (craftPrevArrow) {
          if (currentSlide === 0) {
            craftPrevArrow.classList.add('opacity-30', 'cursor-not-allowed');
            craftPrevArrow.classList.remove('opacity-100', 'cursor-pointer');
          } else {
            craftPrevArrow.classList.remove('opacity-30', 'cursor-not-allowed');
            craftPrevArrow.classList.add('opacity-100', 'cursor-pointer');
          }
        }
        
        // Update next arrow
        if (craftNextArrow) {
          if (currentSlide === totalSlides - 1) {
            craftNextArrow.classList.add('opacity-30', 'cursor-not-allowed');
            craftNextArrow.classList.remove('opacity-100', 'cursor-pointer');
          } else {
            craftNextArrow.classList.remove('opacity-30', 'cursor-not-allowed');
            craftNextArrow.classList.add('opacity-100', 'cursor-pointer');
          }
        }
        
        // Update slide counter
        if (craftCurrentSlide) {
          craftCurrentSlide.textContent = (currentSlide + 1).toString();
        }
      }
      
      // Handle next arrow click
      craftNextArrow.addEventListener('click', function() {
        if (currentSlide < totalSlides - 1) {
          currentSlide++;
          const scrollPosition = currentSlide * craftSlider.offsetWidth;
          craftSlider.scrollTo({
            left: scrollPosition,
            behavior: 'smooth'
          });
          updateArrows();
        }
      });
      
      // Handle prev arrow click
      craftPrevArrow.addEventListener('click', function() {
        if (currentSlide > 0) {
          currentSlide--;
          const scrollPosition = currentSlide * craftSlider.offsetWidth;
          craftSlider.scrollTo({
            left: scrollPosition,
            behavior: 'smooth'
          });
          updateArrows();
        }
      });
      
      // Handle manual scroll to update arrows
      craftSlider.addEventListener('scroll', function() {
        const scrollPosition = craftSlider.scrollLeft;
        const slideWidth = craftSlider.offsetWidth;
        const newSlide = Math.round(scrollPosition / slideWidth);
        if (newSlide !== currentSlide) {
          currentSlide = newSlide;
          updateArrows();
        }
      });
      
      updateArrows();
    }
  });
</script>
